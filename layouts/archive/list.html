{{ define "main" }}
<div class="container">
    <div class="section">
        <div class="section-head is-first">
            <div class="section-head-main">
                <div class="section-label">Archive</div>
                <h1 class="section-title hero-title">{{ .Title }}</h1>
                {{ if .Params.description }}
                <p class="section-copy">{{ .Params.description }}</p>
                {{ end }}
            </div>
        </div>
    </div>

    <div class="search-box section">
        <input
            type="text"
            class="search-input"
            placeholder="Search archive..."
            id="search-notes"
            aria-label="Search archive"
        >
    </div>

    {{ $notes := where .Pages "Params.status" "archived" }}

    <div class="mb-md">
        <span class="sticky-note sticky-note-teal" style="display: inline-block;">
            <strong>{{ len $notes }}</strong> archived notes
        </span>
    </div>

    {{ if $notes }}
    <div class="notes-grid" id="notes-list">
        {{ range $notes }}
        <article class="note-card">
            <div class="note-card-header">
                <h3 class="note-card-title">
                    <a href="{{ .Permalink }}" style="border: none; color: inherit;">
                        {{ .Title }}
                    </a>
                </h3>
            </div>

            <div class="note-card-body">
                {{ .Summary | truncate 200 }}
            </div>

            <div class="note-card-footer">
                {{ if .Params.tags }}
                <div class="note-tags">
                    {{ range .Params.tags }}
                    <span class="tag">{{ . }}</span>
                    {{ end }}
                </div>
                {{ end }}

                {{ if .Date }}
                <span class="note-date">{{ .Date.Format "Jan 2, 2006" }}</span>
                {{ end }}
            </div>
        </article>
        {{ end }}
    </div>
    {{ else }}
    <div class="card-empty-state">
        <div class="card-empty-state-icon">??</div>
        <h3>No archived notes yet!</h3>
        <p>Set a note's status to Archived in Sanity to see it here.</p>
        <p class="empty-signature">Built by <a href="/about/">Mohammad Faisal</a></p>
    </div>
    {{ end }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-notes');
    const notesList = document.getElementById('notes-list');

    if (searchInput && notesList) {
        searchInput.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const cards = notesList.querySelectorAll('.note-card');

            cards.forEach(card => {
                const title = card.querySelector('.note-card-title').textContent.toLowerCase();
                const body = card.querySelector('.note-card-body').textContent.toLowerCase();

                if (title.includes(query) || body.includes(query)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});
</script>
{{ end }}
