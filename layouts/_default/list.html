{{ define "main" }}
<div class="container">
    <!-- Page Title -->
    <div class="title-box-3d mb-lg text-center">
        <h1>{{ .Title }}</h1>
        {{ if .Params.description }}
        <p style="margin: 0; font-size: 1.1rem;">{{ .Params.description }}</p>
        {{ end }}
    </div>

    <!-- Search & Filter Controls -->
    <div class="search-box mb-lg">
        <input
            type="text"
            class="search-input"
            placeholder="Search notes..."
            id="search-notes"
            aria-label="Search notes"
        >
    </div>

    <!-- Notes Count -->
    <div class="mb-md">
        <span class="sticky-note sticky-note-teal" style="display: inline-block;">
            <strong>{{ len .Pages }}</strong> notes found
        </span>
    </div>

    <!-- Notes Grid -->
    {{ if .Pages }}
    <div class="notes-grid" id="notes-list">
        {{ range .Pages }}
        <article class="note-card">
            <div class="note-card-header">
                <h3 class="note-card-title">
                    <a href="{{ .Permalink }}" style="border: none; color: inherit;">
                        {{ .Title }}
                    </a>
                </h3>
            </div>

            <div class="note-card-body">
                {{ .Summary | truncate 200 }}
            </div>

            <div class="note-card-footer">
                {{ if .Params.tags }}
                <div class="note-tags">
                    {{ range .Params.tags }}
                    <span class="tag">{{ . }}</span>
                    {{ end }}
                </div>
                {{ end }}

                {{ if .Date }}
                <span class="note-date">{{ .Date.Format "Jan 2, 2006" }}</span>
                {{ end }}
            </div>
        </article>
        {{ end }}
    </div>
    {{ else }}
    <!-- Empty State -->
    <div class="card-empty-state">
        <div class="card-empty-state-icon">üìù</div>
        <h3>No notes yet!</h3>
        <p>Start creating notes in Sanity Studio to see them here.</p>
        <a href="/studio/" class="btn btn-primary mt-md">Open Sanity Studio</a>
    </div>
    {{ end }}
</div>

<script>
// Client-side search
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-notes');
    const notesList = document.getElementById('notes-list');

    if (searchInput && notesList) {
        searchInput.addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const cards = notesList.querySelectorAll('.note-card');

            cards.forEach(card => {
                const title = card.querySelector('.note-card-title').textContent.toLowerCase();
                const body = card.querySelector('.note-card-body').textContent.toLowerCase();

                if (title.includes(query) || body.includes(query)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});
</script>
{{ end }}
